let currentMealPlan=null;let currentUser=null;document.addEventListener('DOMContentLoaded',function(){try{if(window.matchMedia&&window.matchMedia('(prefers-reduced-motion:reduce)').matches){document.documentElement.style.setProperty('--animation-duration','0s')}initializeApp()}catch(error){console.error('Error initializing app:',error)}});function initializeApp(){const initializers=[{name:'tooltips',fn:initializeTooltips},{name:'form validation',fn:initializeFormValidation},{name:'navigation',fn:initializeNavigation}];initializers.forEach(init=>{try{init.fn()}catch(error){console.error(`Error initializing ${init.name}:`,error)}})}function initializeTooltips(){if(typeof bootstrap==='undefined'){console.warn('Bootstrap not loaded,skipping tooltip initialization');return}const tooltipTriggerList=document.querySelectorAll('[data-bs-toggle="tooltip"]');if(tooltipTriggerList.length>0){tooltipTriggerList.forEach(function(tooltipTriggerEl){try{new bootstrap.Tooltip(tooltipTriggerEl)}catch(e){console.error('Error initializing tooltip:',e)}})}}function initializeFormValidation(){const forms=document.querySelectorAll('.needs-validation');forms.forEach(form=>{form.addEventListener('submit',function(event){if(!form.checkValidity()){event.preventDefault();event.stopPropagation()}form.classList.add('was-validated')})})}function initializeNavigation(){const currentPath=window.location.pathname;const navLinks=document.querySelectorAll('.nav-link');navLinks.forEach(link=>{if(link.getAttribute('href')===currentPath){link.classList.add('active')}})}function showNotification(message,type='info'){const container=document.getElementById('notification-container');if(!container){const newContainer=document.createElement('div');newContainer.id='notification-container';newContainer.style.position='fixed';newContainer.style.top='20px';newContainer.style.right='20px';newContainer.style.zIndex='9999';document.body.appendChild(newContainer)}const alert=document.createElement('div');alert.className=`alert alert-${type}alert-dismissible fade show`;alert.setAttribute('role','alert');alert.innerHTML=` ${message}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>`;const notificationContainer=document.getElementById('notification-container');notificationContainer.appendChild(alert);setTimeout(()=>{if(alert.parentNode){alert.remove()}},5000)}async function apiRequest(url,options={}){const csrfToken=document.querySelector('meta[name="csrf-token"]');const defaultOptions={headers:{'Content-Type':'application/json','X-CSRF-Token':csrfToken ? csrfToken.content:''}};const mergedOptions={...defaultOptions,...options,headers:{...defaultOptions.headers,...(options.headers||{})}};try{const response=await fetch(url,mergedOptions);if(!response.ok){const errorData=await response.json().catch(()=>({error:`HTTP ${response.status}`}));throw new Error(errorData.error||`Request failed with status ${response.status}`)}const data=await response.json();return data}catch(error){if(window.CibozerLogger){window.CibozerLogger.error('API request failed',{url,error:error.message})}showNotification(error.message||'Request failed','danger');throw error}}window.CibozerApp={showNotification,apiRequest};