document.addEventListener('DOMContentLoaded',function(){const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;img.classList.remove('lazy');observer.unobserve(img)}})});const lazyImages=document.querySelectorAll('img.lazy');lazyImages.forEach(img=>imageObserver.observe(img))});function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}}window.requestIdleCallback=window.requestIdleCallback||function(cb){const start=Date.now();return setTimeout(()=>{cb({didTimeout:false,timeRemaining:()=>Math.max(0,50-(Date.now()-start))})},1)};function deferTask(task){if('requestIdleCallback' in window){requestIdleCallback(task,{timeout:2000})}else{setTimeout(task,0)}}class PerformanceMonitor{constructor(){this.metrics={};this.init()}init(){window.addEventListener('load',()=>{if('performance' in window){const perfData=window.performance.timing;const pageLoadTime=perfData.loadEventEnd-perfData.navigationStart;const domReadyTime=perfData.domContentLoadedEventEnd-perfData.navigationStart;const resourceLoadTime=perfData.loadEventEnd-perfData.responseEnd;this.metrics={pageLoadTime,domReadyTime,resourceLoadTime};if(window.location.hostname==='localhost'){}this.sendMetrics()}});this.observeWebVitals()}observeWebVitals(){new PerformanceObserver((list)=>{const entries=list.getEntries();const lastEntry=entries[entries.length-1];this.metrics.lcp=lastEntry.renderTime||lastEntry.loadTime}).observe({entryTypes:['largest-contentful-paint']});new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach((entry)=>{this.metrics.fid=entry.processingStart-entry.startTime})}).observe({entryTypes:['first-input']});let clsValue=0;new PerformanceObserver((list)=>{for(const entry of list.getEntries()){if(!entry.hadRecentInput){clsValue+=entry.value}}this.metrics.cls=clsValue}).observe({entryTypes:['layout-shift']})}sendMetrics(){if(this.metrics.pageLoadTime>3000){console.warn('Page load time exceeds 3 seconds:',this.metrics.pageLoadTime)}}}const perfMonitor=new PerformanceMonitor();function addResourceHints(){const head=document.head;const preconnectDomains=[ 'https:'https:'https:];preconnectDomains.forEach(domain=>{const link=document.createElement('link');link.rel='preconnect';link.href=domain;head.appendChild(link)});const dnsPrefetchDomains=[ 'https:'https:];dnsPrefetchDomains.forEach(domain=>{const link=document.createElement('link');link.rel='dns-prefetch';link.href=domain;head.appendChild(link)})}deferTask(addResourceHints);if('serviceWorker' in navigator&&window.location.protocol==='https:'){window.addEventListener('load',()=>{navigator.serviceWorker.register('/static/sw.js').then(registration=>{}).catch(err=>{})})}class MemoryManager{constructor(){this.listeners=new WeakMap();this.timers=new Set()}addEventListener(element,event,handler){element.addEventListener(event,handler);if(!this.listeners.has(element)){this.listeners.set(element,[])}this.listeners.get(element).push({event,handler})}removeEventListeners(element){const listeners=this.listeners.get(element);if(listeners){listeners.forEach(({event,handler})=>{element.removeEventListener(event,handler)});this.listeners.delete(element)}}setTimeout(callback,delay){const timerId=setTimeout(()=>{callback();this.timers.delete(timerId)},delay);this.timers.add(timerId);return timerId}clearAllTimers(){this.timers.forEach(timerId=>clearTimeout(timerId));this.timers.clear()}cleanup(){this.clearAllTimers()}}window.memoryManager=new MemoryManager();window.addEventListener('beforeunload',()=>{if(window.memoryManager){window.memoryManager.cleanup()}});window.CibozerPerformance={debounce,deferTask,perfMonitor,memoryManager};