let currentMealPlan=null;let currentUser=null;document.addEventListener('DOMContentLoaded',function(){if(window.matchMedia('(prefers-reduced-motion:reduce)').matches){document.documentElement.style.setProperty('--animation-duration','0s')}initializeApp()});function initializeApp(){initializeTooltips();initializeFormValidation();initializeNavigation();initializeNotifications();initializeModals()}function initializeTooltips(){const tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(function(tooltipTriggerEl){return new bootstrap.Tooltip(tooltipTriggerEl)})}function initializeFormValidation(){const forms=document.querySelectorAll('.needs-validation');forms.forEach(form=>{form.addEventListener('submit',function(event){if(!form.checkValidity()){event.preventDefault();event.stopPropagation();showNotification('Please check your form inputs','warning')}form.classList.add('was-validated')})});const inputs=document.querySelectorAll('input[required],select[required],textarea[required]');inputs.forEach(input=>{input.addEventListener('blur',function(){if(this.checkValidity()){this.classList.remove('is-invalid');this.classList.add('is-valid')}else{this.classList.remove('is-valid');this.classList.add('is-invalid')}})})}function initializeNavigation(){const currentPath=window.location.pathname;const navLinks=document.querySelectorAll('.nav-link');navLinks.forEach(link=>{const href=link.getAttribute('href');if(href===currentPath||(currentPath==='/'&&href==='/')){link.classList.add('active')}});document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener('click',function(e){e.preventDefault();const target=document.querySelector(this.getAttribute('href'));if(target){target.scrollIntoView({behavior:'smooth',block:'start'})}})})}function initializeNotifications(){const alerts=document.querySelectorAll('.alert');alerts.forEach(alert=>{setTimeout(()=>{const bsAlert=new bootstrap.Alert(alert);bsAlert.close()},5000)})}function initializeModals(){document.addEventListener('click',function(e){if(e.target.classList.contains('modal')){const modal=bootstrap.Modal.getInstance(e.target);if(modal){modal.hide()}}})}function showNotification(message,type='info',duration=5000){const notification=document.createElement('div');notification.className=`notification notification-${type}show`;const iconMap={success:'check-circle',error:'exclamation-triangle',warning:'exclamation-triangle',info:'info-circle'};const titleMap={success:'Success',error:'Error',warning:'Warning',info:'Info'};notification.innerHTML=`<div class="d-flex align-items-center"><i class="fas fa-${iconMap[type]}me-3"></i><div><div class="fw-bold">${titleMap[type]}</div><div>${message}</div></div><button type="button" class="btn-close ms-auto" onclick="this.parentElement.parentElement.remove()"></button></div>`;document.body.appendChild(notification);setTimeout(()=>{notification.classList.remove('show');setTimeout(()=>{if(notification.parentNode){notification.remove()}},300)},duration)}function formatNumber(num,decimals=1){if(typeof num!=='number')return '0';return num.toFixed(decimals)}function capitalize(str){if(!str)return '';return str.charAt(0).toUpperCase()+str.slice(1)}function formatIngredientName(ingredient){if(!ingredient)return '';return ingredient.replace(/_/g,' ').split(' ').map(capitalize).join(' ')}function validateEmail(email){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailRegex.test(email)}function debounce(func,wait){let timeout;return function executedFunction(...args){const later=()=>{clearTimeout(timeout);func(...args)};clearTimeout(timeout);timeout=setTimeout(later,wait)}}async function apiRequest(url,options={}){try{const defaultOptions={headers:{'Content-Type':'application/json',},};const response=await fetch(url,{...defaultOptions,...options});if(!response.ok){const errorData=await response.json().catch(()=>({}));throw new Error(errorData.error||`HTTP error!status:${response.status}`)}return await response.json()}catch(error){console.error('API request failed:',error);throw error}}function saveToStorage(key,data){try{localStorage.setItem(key,JSON.stringify(data))}catch(error){console.error('Failed to save to localStorage:',error)}}function loadFromStorage(key){try{const data=localStorage.getItem(key);return data ? JSON.parse(data):null}catch(error){console.error('Failed to load from localStorage:',error);return null}}function clearFromStorage(key){try{localStorage.removeItem(key)}catch(error){console.error('Failed to clear from localStorage:',error)}}function formatDate(date){if(!date)return '';const d=new Date(date);return d.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'})}function formatTime(date){if(!date)return '';const d=new Date(date);return d.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'})}async function copyToClipboard(text){try{await navigator.clipboard.writeText(text);showNotification('Copied to clipboard!','success',2000)}catch(error){console.error('Failed to copy to clipboard:',error);showNotification('Failed to copy to clipboard','error')}}function downloadFile(data,filename,mimeType='text/plain'){const blob=new Blob([data],{type:mimeType});const url=URL.createObjectURL(blob);const link=document.createElement('a');link.href=url;link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url)}function animateElement(element,animation='fade-in'){if(!element)return;element.classList.add(animation);element.addEventListener('animationend',function(){element.classList.remove(animation)},{once:true})}function scrollToElement(element,options={}){const target=typeof element==='string' ? document.querySelector(element):element;if(!target)return;const defaultOptions={behavior:'smooth',block:'start',inline:'nearest'};target.scrollIntoView({...defaultOptions,...options})}function isInViewport(element){const rect=element.getBoundingClientRect();return(rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth))}function throttle(func,limit){let inThrottle;return function(){const args=arguments;const context=this;if(!inThrottle){func.apply(context,args);inThrottle=true;setTimeout(()=>inThrottle=false,limit)}}}window.CibozerApp={showNotification,formatNumber,capitalize,formatIngredientName,validateEmail,debounce,apiRequest,saveToStorage,loadFromStorage,clearFromStorage,formatDate,formatTime,copyToClipboard,downloadFile,animateElement,scrollToElement,isInViewport,throttle};